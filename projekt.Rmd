---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Jure Sternad"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Za temo sem si izbral povezavo med gospodarstvom drzav Evrope in COVID-om 

![](slike/grb.png)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Prvo sem uvozil iz surs-sa preko CSV formata naložil podatke o dohodkovni strukturi. Nato sem sestavil tabelo
v obliki *tidy data* .

1. Tabela: `slovenija` - podatki o posameznih panogah
  - `Panoge` - spremenljivka: vrsta panoge,
  - `Kvartal` - spremenljivka: kateri kvartal,
  - `Vrednost` - meritev:  vrednost posamezne panoge v določenem kvartalu.
  - `rast_iz_2018_na_2019` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2018 na 2019,
  - `rast_iz_2019_na_2020` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2019 na 2020.
  
Potem sem uvozil še tabele iz eurostat-a, prav tako v obliki CSV. Sestavil sem tri podobne table (v obliki *tidy data* ), 
v katerih so zbrani podatki o potrošnji gospodinjstev, državnih izdatkih in bdp-u posamezne države.

2. (3., 4.) Tabela: `potrosnja`, `drzava`, `bdp` - podatki o potrošnji gospodinjstev, državnih izdatkih in bdp-u
  - `Drzave` - spremenljivka: drzava,
  - `Kvartal` - spremenljivka: kateri kvartal,
  - `vrednost` - meritev:  vrednost opazovanega neke države v določenem kvartalu,
  - `rast_iz_2018_na_2019` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2018 na 2019,
  - `rast_iz_2019_na_2020` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2019 na 2020.

Na koncu sem še iz https://www.worldometers.info/coronavirus/?utm_campaign=homeAdvegas1?%22%20%5Cl%20%22countries
v obliki hmtl uvozil podatke o okuzbah in populaciji posamezne države, ter sestavil novo tabelo (v obliki *tidy data*),
ki prikazuje podatke o bdp posamezne države, o populaciji, ter o številu zableženih okužb in številu zabeleženih
okužb na sto tisoč prebivalcev

5. Tabela: `zdruzeni`
  - `Drzave` - spremenljivka: drzava,
  - `Stevilo_zabelezenih_okuzb` - meritev: prikazuje koliko okužb je bilo do zdaj zabeleženih,
  - `Populacija` - meritev: populacija države
  - `Stevilo_zabelezenih_okuzb_na_sto_tisoč_prebivalcev` - meritev: izračunano število okužb na 10000 prebivalcev, zaokroženo,
  - `Kvartal` - spremenljivka: kateri kvartal,
  - `vrednost` - meritev:  vrednost opazovanega neke države v določenem kvartalu.
  - `rast_iz_2018_na_2019` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2018 na 2019,
  - `rast_iz_2019_na_2020` - meritev: izračunana povprečna rast prvih treh kvartalov iz let 2019 na 2020.

Spodnji graf prikazuje rast bdp iz 2019 na 2020 (rdeče pike) in rast iz 2018 na 2019 (modre pike) v procentih.

```{r point, fig.align='center', fig.cap='Graf rasti bdp na drzave'}
bdp %>% ggplot() + 
  geom_point(aes(y = Drzave, x = rast_iz_2018_na_2019), color = "blue") +
  geom_point(aes(y = Drzave, x = rast_iz_2019_na_2020), color = "red") +
  ylab('Drzave') +
  xlab('Rast bdp')
ggtitle("Sprememba rasti bdp")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
tm_shape(merge(zemljevid, povprecja, by.x="OB_UIME", by.y="obcina")) +
  tm_polygons("povprecje", title="Povprečje") +
  tm_layout(title="Povprečno število otrok v družini")
```

***

# Napredna analiza podatkov

```{r analiza}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
